<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitor de √Åudio - Par√≥quia (clique onde quiser come√ßar)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f9f9f9; text-align: center; }
        h1::before { content: "‚úùÔ∏è"; font-size: 1.5em; margin-right: 10px; }
        #texto { width: 100%; height: 280px; padding: 15px; font-size: 17px; margin: 15px 0; border: 2px solid #3498db; border-radius: 8px; background: white; }
        button { padding: 12px 20px; margin: 5px; font-size: 16px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #2980b9; }
        #status { margin: 15px; font-weight: bold; color: #27ae60; }
        .destaque-atual { background: #fff3c4 !important; }
    </style>
</head>
<body>
    <h1>Leitor de √Åudio Gratuito</h1>
    <p>Clique em qualquer palavra para come√ßar a ouvir dali<br>Ou selecione um trecho para ler s√≥ ele</p>

    <input type="file" id="arquivo" accept=".txt,.pdf" onchange="carregarArquivo()">
    <textarea id="texto" placeholder="Cole ou carregue seu texto..."></textarea>

    <div>
        <label>Velocidade: <input type="range" id="velocidade" min="0.5" max="2" step="0.1" value="0.9"></label>
        <button onclick="ouvir()">‚ñ∂Ô∏è Ouvir a partir do clique/sele√ß√£o</button>
        <button onclick="parar()">‚èπ Parar</button>
        <button onclick="compartilhar()">üì± Compartilhar</button>
    </div>

    <div id="status">Pronto! Clique no texto onde quer come√ßar.</div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        const textoArea = document.getElementById("texto");
        const status = document.getElementById("status");
        const velocidade = document.getElementById("velocidade");
        let utterance = null;

        // === FUN√á√ÉO PRINCIPAL: permite come√ßar de qualquer ponto ===
        textoArea.addEventListener("click", function() {
            const cursorPos = this.selectionStart;
            status.textContent = `Pronto para come√ßar na posi√ß√£o ${cursorPos} (clique em ‚ñ∂Ô∏è)`;
        });

        async function carregarArquivo() {
            const file = document.getElementById("arquivo").files[0];
            if (!file) return;
            status.textContent = "Carregando...";
            if (file.name.endsWith(".txt")) {
                const t = await file.text();
                textoArea.value = t;
                status.textContent = "TXT carregado ‚Äì clique onde quer come√ßar";
            } else if (file.name.endsWith(".pdf")) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let fullText = "";
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    fullText += content.items.map(item => item.str).join(" ") + "\n\n";
                }
                textoArea.value = fullText.trim();
                status.textContent = `PDF carregado (${pdf.numPages} p√°ginas) ‚Äì clique onde quer come√ßar`;
            }
        }

        function ouvir() {
            parar();
            if (!textoArea.value) return alert("Carregue ou digite um texto primeiro!");

            let textoParaLer = "";
            let inicio = 0;

            // 1. Se tem sele√ß√£o ‚Üí l√™ s√≥ o trecho selecionado
            if (textoArea.selectionStart !== textoArea.selectionEnd) {
                inicio = textoArea.selectionStart;
                textoParaLer = textoArea.value.substring(inicio, textoArea.selectionEnd);
                status.textContent = `Lendo trecho selecionado (${textoParaLer.split(" ").length} palavras)`;
            } 
            // 2. Sen√£o, l√™ a partir do cursor (clique)
            else {
                inicio = textoArea.selectionStart || 0;
                textoParaLer = textoArea.value.substring(inicio);
                status.textContent = "Lendo a partir do ponto clicado...";
            }

            utterance = new SpeechSynthesisUtterance(textoParaLer);
            const voices = speechSynthesis.getVoices();
            const vozBR = voices.find(v => v.lang.includes("pt")) || voices[0];
            if (vozBR) utterance.voice = vozBR;

            utterance.rate = parseFloat(velocidade.value);
            
            // Destaque simples (rola at√© o ponto de in√≠cio)
            textoArea.focus();
            textoArea.setSelectionRange(inicio, inicio);
            textoArea.scrollTop = textoArea.scrollHeight * (inicio / textoArea.value.length);

            utterance.onend = () => status.textContent = "Leitura conclu√≠da üôè";
            utterance.onerror = () => status.textContent = "Erro ‚Äì tente recarregar a p√°gina";

            speechSynthesis.speak(utterance);
        }

        function parar() {
            speechSynthesis.cancel();
            status.textContent = "Parado.";
        }

        function compartilhar() {
            const url = location.href;
            const msg = "Ou√ßa a B√≠blia ou qualquer texto clicando onde quiser! Totalmente gr√°tis ‚Üí " + url;
            if (navigator.share) navigator.share({title: "Leitor de √Åudio Par√≥quia", text: msg});
            else { navigator.clipboard.writeText(msg); status.textContent = "Link copiado para o WhatsApp!"; }
        }

        // Carregar vozes
        if (!speechSynthesis.getVoices().length) {
            speechSynthesis.onvoiceschanged = () => status.textContent = "Vozes carregadas ‚Äì clique no texto!";
        }
    </script>
</body>
</html>